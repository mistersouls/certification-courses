
# AZ-104

## Azure AD

External resources: Microsoft Office 365, Azure Portal, SaaS applications
Internal resources: Applications whithin your internal networking, Access to workstations on-premise

Azure AD to implement Single-SIgn on (SSO)

It comes in four editions
1. **Free** MFA, SSO, Basic security and usage reports, user management
2. **Office 365 Apps** company branding, SLA, Two Sync between On-Premise and Cloud
3. **Premium 1** Hybrid architecture, advanced group access, conditional access
4. **Premium 2** Identity protection, identity governance

### Azure AD - Use case

Authorize and authenticate to multiple sources:
* To your on-premise AD
* To your Web-application
* Allow users to login with their IpD eg. Facebook or Google
* To office 365 or Azure Microsoft

Azure AD connect => on-pemise

### Active directory vs Azure AD

Azure AD = Ad + an identity as a service IDaaS solution for all theirs apps across cloud and on-premises.


### Terminology

**Domain**: logical grouping of AD objects on a network

**Domain Controller (DC)**: a server that authenticates user identtities and authorize their access to resources

**Domain Computer**: a computer that is registered with a central authentication database. It would be an AD object.

**AD object**: the basic element of AD such as users, groups, printers, computers, shared folders...

**Group Policy Object (GPO)**: a virtual collection of policy settings. it controls what AD objects have access to.

**Organization Units (OU)** a subdivision within an AD into which you can place users, groups, computers and others OU.

**Directory service (AD DS)** provides the methods for storing directory data and making this data available to network users and admin.

### Azure AD - Tenant

A tenat represents an organization
A tenant is a dedicated Azure AD Service instance.
A tenant is automatically created when you sign up for either
* Microsoft Azure
* Microsft Intune
* Microsft 365

Each Azure AD tenant is distinct and separate from Azure AD tenants

### Azure Active Directory Domain Services (AD DS)

When doing a lift-and-shift from on-premise to Microsoft Azure and migrating Active directory, Azure AD soes not support some domain services.

AD DS provides managed domain service such as:
* Domain joins
* Group policies
* LDAP
* Kerberos / NTLM authentication

### Azure AD Connect

A hybrid service to connect your on-premise to your Azure account. It allows for seamless SSO from your on-premise workstation to Azure.

Azure AD connect has the following features:
* Password hash synchronization
* Pass-through authentication
* Federation integration
* Synchronization
* Health monitoring

### Azure AD - Users

* You can asign roles and **administrative roles** to users
* You can add users to groups
* Yiu can enforce authentication methods such as MFA
* You can track users sign ins
* Track devices user's login from and allow or deny devices.
* Assign microsoft licences

Two type of users:
* users
* Guest users

*Users are permanently deleted automatically 30 days after they are deleted.* You can restore before at.


### Azure AD - Groups

Groups lets the resource owner (or Azure AD directory owner), assign a set of access permissions to all the members of the
group, instead of having to provide the rights one-by-one.

**Groups contain**:
* Owners - Has permissions to add or remove members
* Members - Have permissions to do things

**Assignment**
* You can assign roles directly to a group
* You can assign applications directly to a group

**Request to join groups**
The group owner can let users find their own groups to join, instead of assigning them.


### Azure AD - Assign access rights

* **Direct assignment**: resource owner directly assigns the user to the resource.
* **Group assignment**: resource owner assigns an Azure AD group to the resource, which gives all of the group members access to the resource.
* **Rule-based assignment** resource owner creates a group and uses a rule to define which users are assigned to a specific resource.
* **External authority assignment**: Access comes from an external source, such as an on-premises directory or a SaaS app.

### Azure AD - External identities

Allow peeople outside your organization to access your apps and resources, while letting them sign in using whatever identity
they prefer.


### Azure AD - Device management

**What is Device identity manageemnt?**
The management of **physical devices** such as phones, tablets, laptops and desktops computers, that are granted access
to company resources such as Printers, CLoud resources vi *device-based Conditional Access*.

For companies with a distributed workforce, that allows remote remployess and employes who are allowed you use their own
personal equipment eg. **Brin Your Own Device (BYOD)**

A company needs a way to protect their organization's assets such as access to cloud resources across these devices
where they have *less control over the physical securities of the work environment*

1. Azure AD registered: windows 10, iOS, Android, MacOS
* personally owned or mobile devices
* and signed in with a personal microsoft or local account

2. Azure AD Joined: Windows 10, Windows Server 2019
* owned by an organization
* and signed in with an Azure AD account belonging to the organization
* They exist only in the cloud

3. Hybrid Azure AD joined: Windows 7, 8.1 or 10, Windows server 2008 or newer
* owned by an organization
* And are signed in with an AD DS account beloging to that organization
* They exist in the cloud and on-premises

### Azure AD Registered Devices

**Definition** Registered to azure AD without requiring organizational account to sign in to the device
**Primary audience** Bring your own device (BYOD), mobile devices
**Device ownership** User or organization
**Operating Systems** Windows 10, iOS, Android and MacOS
**Provisioning**
* Windows 10 - Settings
* iOS/Android - Company Portal or Microsoft Authenticator app
* MacOS - Company Portal
**Device sign in options**
* End-user local credentials, Password, Windows Hello, PIN
**Device management**
* Mobile device management (example: Microsoft Intune)
* Mobile application management
**Key capabilities**
* SSO to cloud resources
* Conditional access when Enrolled into Intune
* Conditional access via App protection policy
* Enables phone sign in with Microsoft Authenticator app


#### Azure AD Registered Devices - Windows Hello

gives windows 10 users an alternative way to log into their devices and apllications using: fingerprint, iris scan, facial
recognition.

#### Azure AD Registered Devices - MDM and MAM

MDM: Mobile Device Management: control the entire divie, can wipe data from it, and also reset it to factory settings.

MAM: Mobile Application Management: publish, push, configure, secure, monitor and update mobile apps for your users

MDM and MAM is managed via Microsft intune. They are located under Azure AD.

#### Azure AD Registered Devices - EMS

EMS (Microsoft Enterprise Mobility + Security) is an intelligent mobility management and security platform.
Protect and secure your organization and empowers your employees to work in new and flexible ways.
EMS is an **umbrella** of multiple Microsft and Azure services.


#### Azure AD Registered Devices - Micorsoft authenticator

Secure sign-ins for all your online accounts using:
* MFA
* Passwordless
* password autofill


### Azure AD Joined Devices

**Definition** joined only to Azure AD requiring organizational account to sign-in to the device
**Primary audience**: suitable for both cloud only and hybrid organizations.
**Device ownership** organization
**Operating systems** all windows 10 devices except windows 10 Home, windows server 2019 virtual machines running in Azure
(server core is not supported)
**Provisioning** Self service: windows OOBE or Settings, bulk enrollment, Windows Autopilot
**Device sign in options**: organizational accounts using: password, Windows Hello for Business, FIDO2.0 security keys(Preview)
**Device management** MDM(Microsft intune), Co-Management with Microsoft intune and Microsoft Endpoint config manager
**Key capabilities**:
* SSO to both cloud and on-premises resources
* Conditional access through MDM enrollment and MDM compliance
* Self service password reset and Windows Hello PIN reset on lock screen
* Enterprise state roaming accross devices

#### Azure AD Joined Devices - FIDO2.0 Security Keys

FIDO (Fast identity online):

A security key? A secondary device used as second step in authentication process to gain access to a device, workstation or app.
A security key can resemble a memory stick. When your finger make contact with a button or exposed metal on the device,
it will generate and autofill a security token.

### Hybrid Azure AD Joined Devices

**Definition** Joined to on-premises AD and Azure AD requiring organizational account to sign in to the device
**Primary audience** Suitable for hybrid organizations with existing on-premises AD infrastructure
**Device ownership** organization
**Operating Systems**: Windows 10, 8.1 and 7, Windows server 2008/R2, 2012/R2 and 2019
**Provisioning**
* Windows 10, Windows server 2016/2019
* Domain join by Windows Autopilot and autojoin via Azure AD connect or ADFS config
* Windows 8.1, Windows 7, Windows server 2012 R2, Win server 2012 and Win server 2008 R2 - Require MSI

**Device sign in options** Organizational accounts using: password, windows hello for business for win10
**Device management** group policy, config manager stadalone or co-management with microsoft intune
**key capabilities**:
* SSO to both cloud and on-premises resources
* Conditional Access through Domain join or through Intune


### Types of Azure roles

Roles can be confusing because Azure has three types of roles that can serve same purpose 

1. Classic subscription administrator roles
This is the original role system

2. Aure roles
This is an authorization system is known as Role-Based Access Controls (RBAC) and is built on top of Azure Resource Manager.

3. Azure Active Directory (Azure AD) roles
Azure AD roles are used to manage Azure AD resources in a directory.


#### IAM Access controls

Allows you to create and assign roles to users.


**Azure Roles (RBAC system)** Roles restrict access to resource actions (also known as operations). There are two types of
roles:
1. Builtin Role
2. Custom Role

#### Classic administrators

It is the original role system. There is three types of roles:
1. Account administrator: The billing owner of the subscription. Has no access to the Azure portal
2. Service administrator: same access of a user assigned the owner role at subscription scope. Full access to the Azure portal
3. Co-adminsitrator same access of a user who is assigned the owner role at the subscription scope

#### Azure Role-BAsed Access COntrol (RBAC)

Azure role-based access control (Azure RBAC) helps you manage who access to Azure resources, what they can do with those
resources, and what areas have access to.

A **role assignment** is consists of these three elements: Security principal, role definition, scope.

**Security Principal** represents the identities requesting access to an Azure resource such as: User, Group, Service Principal (used by app, service...), Managed identity (AD).

**Scope** is the set of resources that access for the role assignment applies to.

**Role definition** is a collection of permissions. A role definition lists the operation that can be performed such as **read**, **write** and **delete**

Azure has **built-in roles** and you can define **custom roles**

**built-in roles**: Owner, Contributor, Reader, User Access Administrator

#### Azure AD Roles

Azure AD roles are used to manage Azure AD resources in a directory such as:
* create or edit users
* assign administrative roles to others
* reset user passwords
* manage user licenses
* manage domains

A few important Built-in Azure AD roles you should know:
* Global Adminsitrator: Full access to everything
* User administrator: full access to create and manage users
* Billing administrator: Make purchases, manage subscriptions and supports tickets.

#### Policies vs RBAC

Azure Policies: ensure compliance of resource => doesn't restrict actions
Azure ROles: used to control access to Azure resources

#### Azure AD Roles vs Azure ROles (RBAC)

Azure AD Roles resources being: users, groups,, billing, licensing, application registration, ....
Azure Roles resources being: virtual machines, databases, cloud storage, cloud networking, ...

### Azure Policies

Azure policy enforce organizational standards and to assess compliance at-scale policies do not restrict access, they only observe for compliance.

**Policy definition** is a JSON file used to describe business rules to control access to resources.
**Policy assignment** the scope of a policy can effect. Assigned to a user, a resource group or management group.
**Policy parameters** values you can pass into your Policy definition so your policy are more flexible for re-use.
**Initiative definition** is a collection of policy definition that you can assign. eg. A group of policies to enfore PCI-DSS compliance.

#### Anatomy of an Azure policy definition file

**display name** identifies the policy (128 character limit)
**Type**
* Bult-in - maintained by Microsoft
* Custom - created by you
* static - micorosft owned, a regulatory compliance
**description**
**metadata** optional key value information
**mode** determines which resource type are evaluated
* Resource Manager
- All - resource groups, subscriptions...
- Indexed - only resource types that support tags and location
* Resource provider
- Microsoft.ContainerService.Data (deprecated)
- Microsoft.Kubernetes.Data
**Parameters:**
- name
- type
- metadata
**Policy Rule** consists of *if* and *then*. 

## Azure Resource Manager


### Resource providers

In order to use Azure resources you have to register Resource Providers. Many resource Providers are registered by default for you with your subscription. You can register Resource providers under your subscription.


### Resource tags

A tag is a key and value pair that you can assign to azure resources.

### Resource locks

As an admin, you may need to lock a subscription, resource group or resource to prevent other users from accidentally
deleting or modifying critical resources.

In the Azure Portal you can set the following lock levels.

**canNotDelete (Delete)**: authorized users can still read and modify a resource, but they can't delete the resource.
**ReadOnly** authorized users can read a resource but they can't delete or update the resource

When resource group is locked of delete type, you can move out the content resource.
When resource group is locked of read type, you can not move out the content resource but you can move in.

### Azure blueprints

Azure blueprints enable quick creation of governed subscriptions. Compose artifacts based on common or organization-based
patterns into re-usable blueprints. The service is designed to help with environment setup.

Blueprints are declarative way to orchestrate the deployment of various resource templates and other artifacts such as:
* Role assignements
* Policy assignments
* ARM templates
* Resource groups

The Azure Blueprints service is backed by the globally distributed **Azure Cosmos DB**
Blueprint objects are replicated to multiple Azure regions.

**ARM Templates vs Azure Blueprints**:
Nearly everything that you want to include for deployment in Azure Blueprints can
be accomplished with an ARM template.
**ARM teplate** stored either locally or in source control, no active connection or relationship to the ARM template
**Azure Blueprints** relationship between the blueprint definition and the blueprint assignment, can also upgrade
several subscriptions at one that are governed by the same blueprint.


### ARM template

*$schema* describes the properties within a template
*contentVersion*: the version of the template. You can provide any value for this element.
*apiPorfile*: Use this value to avoid having to specify API versions for each resource in the template.
*parameters* values you can pass along to your template
*variables* you tranform parameters or resource properties using function expressions.
*functions*: user-defined functions
*resources*: the azure resources
*outputs*


In resource you can access a parameter with eg. `"name": "[parameters('storageName')]"`

**Parameters**
* type: string, securestring, int, bool, object, secureObject and array
* defaultValue


## Storage accounts

Azure storage offers several types of storage accounts. Each with different features and their own pricing models
* General-purpose v1 (legacy)
* General-purpose v2
* BlobStorage (legacy)
* BlockBlobStorage
* FileStorage

**Storage type** and **Account Kind** means the same thing.
**Supported services**: Blob, File, Queue, Table, Disk and Data Lake Gen2
**Performance Tiers** Standard and Premium
**Access Tiers** Hot, Cool, Archive
**Replication** LRS, GRS, RA-GRS, ZRS, GZRS, RA-GZRS
**Deployment model** resource manager classic


* General-purpose v2
- Service: Blob, File, Queue, Table, Disk, Data Lake Gen 2
- Performance tiers: Standard, Premium
- Access tiers: Hot, Cool, Archive
- Replication: LRS, GRS, RA-GRS, ZRS, GZRS, RA-GZRS
- Deployment models: Resource manager

* General-pupose V1:
- Service: Blob, File, Queue, Table
- Performance tiers: Standard, Premium
- Access tiers: N/A
- Replication: LRS, GRS, RA-GRS
- Deployment models: Resource manager **classic**

* BlockBlobStorage
- Service: Blob(block, append)
- Performance tiers: Premium
- Access tiers: N/A
- Replication: LRS, ZRS
- Deployment models: Resource manager

* FileStorage
- Service: File
- Performance tiers: Premium
- Access tiers: N/A
- Replication: LRS, ZRS
- Deployment models: Resource manager

* BlobStorage
- Service: Blob(block, append)
- Performance tiers: STandard
- Access tiers: Hot, Cool, Archive
- Replication: LRS, GRS, RA-GRS
- Deployment models: Resource manage

### Core Storage service

Azure has 5 core storage services:
* Azure Blob: a massively scalble object store for test and binary data. Also includes support for big data through data lake gen 2
* Azure Files: Managed file shares for cloud or on-premises deployments
* Azure Queues: A NoSQL store
* Azure Tables: A messaging store for reliable messaging between application deployments
* Azure DIsks: Block-level storage volumes for Azure VMs

### Performance Tiers

2 types: standard and premium
IOPS stands for input/output operations per second

Premium performance: stored on solid state drivers (SSDs), low-latency, higher through
Standard performance: HDD (Hard disk drive)

### Access Tiers

3 types of access tiers for standard storage: Cool, Hot and Archive

**Hot**
* Data that's accessed frequently
* Highest storage cost, lowest access cost

**Cool**
* Data that's infrequently accessed and stored for at least 30 days.
* Lower storage cost, higher access cost

**Archive**
* Data that's rarely accessed and stored for at least 180 days
* Lowest storage cost, highest access cost

### Replication

Replication type:
- Primary Region Redundancy
* LRS: Locally Redundant Storage => disaster recovery and failovers
* ZRS: Zone-redundant storage
- Secondary Region Redundancy
* GRS: Geo redundant storage => Disaster Recovery and Failovers
* GZRS: Geo-zone-redundant storage
- Secondary region redundancy with Read Access
* RA-GRS: Read-access geo-redundant storage => read replicas
* RA-GZRS: Read-access geo-redundant storage

#### Redundancy in the primary region

* Data is replicated 3 times in the primary region
* There are two options for storing in the primary region

LRS: 11 nines, copies data synchronously in primary region, cheapest option
ZRS: 12 nines, copies data synchronously accross 3 AZs in primary region

#### Redundancy in the secondary region

* Replicate to a secondary region in case of primary regional disaster
* The secondary region is determinated based on your primary's pair region
* Secondary region isn't available for read or write access (except in event of failover)

- GRS: 3 copies synchronously in primary and 3 asynchronously in secondary, 16 nines
- GZRS: 3 copies accross AZ synchronously and 3 another region, 16 nines

### Redundancy in the secondary region with read access

- RA-GRS: 3 copies synchronously in primary and 3 copies synchronsously in secondary, 16 nines
- RA-GZRS: 3 copies synchronously accross 3 AZs, copies synchronously to secondary, 16 nines

### Azure Blob

- unstructered data such as text or binary
- a unique namespace in azure data
- 3 types:
1. Block blobs
* store text and binary data
* made up of blocks of data that can be managed individually
* store up to about 4.75 TiB of data
2. Append blobs
* optimized for append operations
* ideal for scenarios such as logging data from vms
3. Page blobs
* store random access files up to 8 Tib
* ...

There are multiple ways to move data into Azure Blob Storage
* AzCopy
* Azure Storzge Data Movement library: .NET
* Azure Data Factory: AN ETL service
* Blobfuse
* Azure Data Box
* Azure Import/Export service


### Azure Files

a fully managed file share in the cloud allowing multiple connections

To connect to the file share a network protocol is used
* Server Message Block: SMB
* Network File System: NFS

**Backups** with **shared snapshots**
* The are read-only
* incremental
* up to 200 snapshots
* retain for up to 10 years
* BAckups are stored within your file share (if you delete your file share you will delete your backups)

**Soft delete** prevent accidental deletion (stroage will be marked fir deletion and retained for a period of time before final delete occurs)

**Advanced threat protection (ATP)** additional layer of security intelligence that provides alerts when it detects anomalous
activity on your storage account.

**Store Tiers**
* Premium - Store on to SSD with single-digit milliseconds for most IO operation
* Transaction optimised - Store on HDD with transaction heavy workloads that don't neeed the latency offered by premium file shares (historically this tier has been called **standard**)
* Hot - optimised for general purpose
* Cool

**Types of storage**
* General purpose version 2: GPv2 - HDD
* FileStorage - SSD

**Identity**:
* On premise: joined to an o,n-premise AD DS
* Managed - joined Microsft managed AD DS
* Store Account Key: A username (storage account name) and password (account key) can be used to mount


**Networking**
* Accessible vi storage account **public endpoint**
* SMB connects to port 445

**Encryption**
* AZure Files is encrypted-at-rest using SSE (Azure Storage Service Encryption)
* encrypted-in-transit with SMB 3.0+ with encryption or HTTPS


**Azure File Sync** is a service that allows you to cache Azure file shares on an on-premises Windows Server or Cloud VM.
You can use any protocol that's available on Windows Server to access your data locally, including SMB, NFS and FTPS

### AZCopy

AZCopy is a command-line utility that you can use to copy blobs or files from a storage account.
login with `azcopy login` -> AD or Shared Access Signature (SAS)
Authorization via attached roles:
* To download => Storage Blob Data Reader
* To upload: Storage Blob Data Contributor, Storage Blob Data Owner

### Azure Import/Export Service

To prepare you drive you'll need the to use the command-line **WAImportExport**. This one has 2 versions:
* version 1 for import/export into Azure Blob storage
* version 2 for importing data into Azure files

### Shared Access Signature

A SAS is a URI that grants restricted access rights to Azure Storage resources.
* Account-level SAS: access to resources in one or more of the storage services
* Service-level SAS: access to single the storage account by using the storage account key
* User delegation SAS: Access to storage account using Azure AD credentials, limited only to Blob and Containers, Microsoft considers
this method best practice for accessing via SAS
* Ad hoc SAS: start time, expiry time and permission are part of the URI


## Azure VMs

Vm is grouped into:
* Types: eg. General Purposes, Compute optimized
* Sizes: eg. B, Dsv3 (also called Series SKU Family)

Azure Compute Units (ACU) provides a way of comparing compute (CPU) performance accross Azure SKUs.


### Azure Mobile App

Monitor your Vms with Azure Mobile App

### Hyper-V and Generation 1 vs 2

Hyper-V is Microsoft's hardware virtualization product.
It lets you create and run a software version of a computer, called a virtual machine.

* Generation 1 - support most guest OS
* Generation 2 - support most 64-bit versions of Windows and more current versions of Linux and FreeBSD operating systems.

### SSH, RDP and Bastions

3 way:

* Secure Shell (ssh)
* Remote Desktop Protocol: provides a user with a graphical interface, port 3389
* Bastion: Azure Bastion is a service you deploy that lets you connect to a virtual machine. You can use it to connect
to your taget server via SSH or RDP.

Some devices cannot run a RDP cliet such as Google Chromebook and so Azure Bastion is one of the only ways to allow you to do that.
When you create an Azure Bastion you need to add a subnet to your VNet called AzureBastionSubnet with at least a size of /27 (32 addresses)

### Windows Vs Linux Servers

Windows:
* need a Windows license (or your windows account with by unactivated)
* You can bring your own license vi Hybrid License
* you set a user name and password
* You have to use a much larger instances to run windows at least a B2
* It's a full desktop environment

Linux
* Most versions of Linux require no type of license
* You set either a username and password or to create a SSH-key pair
* You can utilize smaller VM sizes because you're not running a full desktop experience


### Update management

Update management allows you to manage and install operating sytem updates and patches for both Windows and Linux virtual machines

When you create  launch an Azure VM you ccan go Operations and tturn on Guest + Host updates. This will be monitor your Vm.



### Azure Disks

* Managed disks are designed for 99.999% availability
* Azure creates three replicas of your data, allowing for high durability
* you can create up to 50000 VM disks of a type in a subscription per region
* Allowing you to create up to 1000 VMs in a virtual machine scale set
* Integrated whith availability sets and support availability zones
* Azure backup can be used to create a backup job with time-based backups and backup retention policies
* You can use RBAC to assign specific permissions for a managed disk
* You can directly import your Virtual Hard Drive Disk (VHD) into Azure Disks
* You can use Azure Private Links to ensure traffic Azure Disks and VMs stay within the Microsft network


Encryption:
* SSE (Server side encryption) enable by default for all disks, snapshots and images.
* Azure Disk encryption: Bitlocker for windows

Disk Roles:
3 main roles: data disk, os disk, temporary disk

Disk types:
* ultra disks => can only be used as data disks (use a Premium SSD for OS disk), only supported with specific VM
* Premium SSD
* Standard SSD
* Standard HDD

A managed disk snapshot is a read-only crash consistent full copy of a managed disk that is stored as standard managed disk by default.
It bill based on the used size (if you have 64 and only used 10, you will pay for 10 )

A managed custom image create an image (of your disk from you VM. Contains all managed disks associated with a VM, OS and data disk).
A snapshot doesn't have awareness of any disk except the one it contains.


## Application gateway

Azure application gateway is application level routing and load balancing serice baseed on OSI layer 7.
You need to configure:
* Frontend: private ip create an internal load balancer, public ip creates public/external load balancer
* Backend: you need to create a bakend pools (collection of resources to which your app gateway can send traffic).
* Routing Rules: Frontend IP configuration, listeners, HTTP/s settings

There are 2 types listeners:
1. Basic - forward all requests for any domain to backend
2. Multi-site - forwards requests to different backend pools based on host header and host name

Backend targets: Choose where a route should either Backend Pool or Redirection

HTT settings: allow how to handle cookies, session...

Azure Web Application Firewall (WAF) policies can be attached to an Application gateway to provide additional security

## Azure Scale Sets

Allows you to automatically increase or decrease your VM capacity.

A **load balancer** can be associated with a scale set.
This will allow you to evenly distribute your VMs accross multiple availability zone.

A **scaling policy** determine when a VMs will be scaled. To configure rules:

Built-in Host-based metrics:
* Percentage CPU
* Network in
* NEtwork out
* Disk read bytes
* Disk write bytes
* DIsk read operations/sec
* disk write operations/sec
* CPU credits remaining
* CPU credits consumed

Aggerates:
* Average
* minimum
* maximum
* ...

Operator:
* Greater than
* Greater than or equal to
* ...

Actions
* Increase count by ...
* ...

**Scale-In Policy** is how determines what VM is removed to decrease the capacity.
Default:
* Delete the VM with highest instance ID
* Balanced accross AZ and Fault domains (ADs)
Newest VM:
* Delete the newest created VM
* Balanced accross AZ


**Health monitoring** can be enabled to determine if your server is healthy or unhealthy.


## Azure App Service

Azure App service is an HTTP-based service for hosting web application, REST APIs and mobile backends.
It is a Platform as a service, so it's the Heroku equivalent for Azure.

### Runtime environment

A runtime software/instructions that are executed while your program is running.
With Azure App Services you choose a runtime:
* .NET
* .NET Core
* Java
* Ruby
* Python
* ....


### Azure App Service - App Service Environment

App service environment (ASE) is an azure App service feeature that provides a fully isolated and dedicated environment
for securely running App service apps at high scale. This allow you to host:
* Windows web apps
* Linux web apps
* Docker containers
* Mobile apps
* Functions

If the Vnet is connected to your on-premise network, no need additonal configuration.

### Azure App service Plan

Azure App Service Plan defines how you pay and what resources are available to you.
3 pricing tiers:
* Shared tiers: Free tier and share tier
* Dedicated tiers: Basic, Standard, Premium, PremiumV2, PremiumV3
* Isolated Tier: dedicated azure virtual network...

## Azure Monitor

Azure Monitor comprehensive solution for collecting, anlyzing and acting on telemetry
from your cloud and on-premises environements.
* Creat visual dashboard
* smart alerts
* automated actions
* log monitoring

The sources of common monitoring data to populate datastores order by (highest to lowest)
* Application
* Operating system
* Azure resources
* Azure subscription
* Azure tenant
* custom sources

The functions that azure monitor can perform: insights, visualization...

**Application code** performance and functionality of application code. Performance traces, application logs and user telemetry

Metrics => Metrics explorer
Logs => Log analytic
Azure event hub => Non-Azure destination.

Azure Monitor collects tow fundamental types of data from sources: **Logs** and **Metrics**

**Azure Monitor Logs**
* collects and organizes log and performance data from monitored resources.
* data logs are consolidated from different sources into **workspaces**

**Log Analytics workspace** is a unique environement for Azure Monitor log data. Each workspace has its own data repository.

**Log Analytic** is a tool in the Azure Portal used to edit and run log queries with data

### Kusto and kusto Query Language (KQL)

Azure Monitor Logs is based on Azure Data Explorer, and log queries are written using the KQL

### Metrics Explorer

Metric explorer is a sub-service of AZure Monitor. TO visualize a metric you need to define:

**Scope** you can select *resource(s) eg. VM, StorageAccount
**Namespace** a specific group

### Azure alerts

Alerts notify you when issues are found.
**The Alert Rule** defines who should we monitor and when should we react.
**The Signal** is a data payload emitted from the resource that could be the following types: Metric, Log, Activity log, insights
**Target resource**: eg VM
**Action group** contains actions to be that will be performed when alert is trigerred
**An action** could be a: automation runbook, Azure function, Logic APP, ITSM


### Azure Dashboards

Dashboards are a virtual workspaces to quickly launch tasks for day-to-day operations and monitors resources.


## Azure Backup Service

Azure Backup Service is a backup level that spans many Azure services.

What can I backup?
* On-Premise
* Azure VMs
* Azure Files
* SQL server (with Azure VM)
* SAP HANNA databases (within Azure VM)
* Azure Database for Postgresql server

Why use Azure Backup?
* Offload on-premises backups
* Backup your VMs
* Scales easily
* Get unlimited data transfer
* Keep data secure
* Centralized monitoring and management
* App consistent Backups
* ...

### Azure Recovery Service Vault

Azure Recovery Service (ARS) vault is a storage entity in Azure that houses data and recovery points created over time.
The data is copies of data, or configuration information for VMs, workloads, servers, or workstations.
Backup data for various Azure service: eg.
* IAAS VMs (Linux or Windows)
* Azure SQL databases

### MARS agent

Microsoft Azure Recovery Service (MARS) agent can back up files, folders and system state from Windows on-premise machines and Azure VMs.
Backups are stored in a Recovery Service vault in Azure. MARS agent is also knows as the Azure Backup agent.
The MARS agent does not support Linux OS.
To install the agent and perform backups you'll need to:
* create ARS vault
* create a backup policy within the vault
* configure secure route for back eg. ExpressRoutes or Private Endpoints (optional)
* Download the MARS agent
* Install and register the agent

### Azure Backup Policy

To create a backup policy you choose a datasource type:
* Azure VMs or PSQL database
* choose the frequency

### Azure Site recovery

Azure site recovery is a hybrid backup solution for site-to-site recovery.
ASR is one of the tools for your business continuity and disaster recovery (BCDR) strategy.
Site recovery replicates workloads from a primary site to a secondary site.
In case primary site suffers a failure, Site recovery will fail-over to secondary site.

### Recovery Service Vault vs Backup Vault

- Recovery Service vault:
* Azure VM
* SQL in Azure VM
* Azure Files
* SAP HANNA in Azure VM
* Azure Backup Server
* Azure BAckup agent
* DPM

- Backup vault
* Azure Disks
* Azure Blobs (Azure Storage)
* Azure Database for Postgresql servers


## ACI: Azure Container Instance

billed in seconds whereas VM is billed in hours. The troubleshoot a conatiner you can pull logs with `az container logs`.
To get diagnostic information during container startup use `az container attach`.
To start an interactive container run `az container exec`

## Azure DNS

Azure DNS is a hosting for DNS domains that provides name resolution by using Microsoft Azure Infrastructure

- Public DNS - internet-facing
* Pointing your domain to your website
* Setting records to prove you own the domain
* Records to connect you domain to your email server

- Private DNS internal-facing
* Allow you to use your own custom domains instead of the Azure provided domains. Many azure services use fully qualified domain name
(FQDN) to identify services on the network. eg. Azure Storage accounts FQDN: http://storageaccount.file.core.windows.net

**You can't use Azure DNS to buy a domain name.** You can purchase a domain in App services or a third party providers and have
Azure DNS manage

### Zones, Records and Record sets

A DNS zone is a container for all your DNS records for a specific domain name.
A DBS record is a rule that says where to send your domain name

#### Records sets

In Azure you always create record sets even when you just want a single record.

- Naming your record
**Name A** record that has a name is considered a Fully qualified domain (FQDN) or you can think of it as a subdomain. eg. https://www.souls.com

**No Name A** record tthat is left empty is considered an apex or naked domain. eg. https://souls.com

**Wildcard** you can set wildcars which act as catch-alls. Eg * or *.trick

**@** YOu can use an at-sign (@) as your name. This shortland for saying ORIGIN. So this means you're pointing to the naked domain.


- Record Type:
* *A* **Address** lets you point your domain to an IPv4 address
* *AAAA* lets you point your domain to an IPv6 address
* *CAA* **Certificate Authorities (CAs)** records authorized who can issue certificates for their domain
* *CNAME* **Canonical Name** record creates an alias from one domain to another so you set the record value to a domain.
* *MX* Mail exchange
* *NS* **Name Server** records identify multiple DNS servers
* *PTR* **Pointer** record points to a domain or host name but it used for reverse DNS lookup
* *SRV* **Service**
* *TXT* **Text**
* *SOA* **Start of Authority**
* *Alias* ==> Azure has its own special record type that work with A, AAAA and CNAME. Azure Alias record points directly
to an Azure resource instead of to an IP or hostname (avoid dangling domain).

## Azure Virtual Network (VNet)

VNet is a logically isolated section of the Azure Network where you launch your Azure resources.
- Azure DNS - manage your own DNS domain
- Virtual Network (vNEt) - logically isolated section of Azure Network (Address spaces, Route Tables, SUbnets)
- Network Security Groups (NSG) a virtual firewall at the subnet or NIC level
- ExpressRoute - A 50 Mbps-10 Gbps connection between on-premise to VNET
- Virtual WAN -  a centralized network to route different network connections.
- Virtual Network Gateway - A site-to-site VPN connection between an VNet and local networks.
- Network interfaces - virtual network device to allow your VMs to cummunicate using IP proctols


### VNet Peering

It is when you connect multiple VNet to they act as one network.
There are 2 types of VNet peering:
1. Regional VNet Peering - When you peer two VNets from the same region
2. Global VNet peering - When you peer two VNets from two different regions.


### Network Routes and Routes Tables

- Default routes
By default Azure creates a route table with defaults routes and associates them to your subnets so you don't have to
do anything to get routing. If you were to check the Azure Route Table service you won't see these default route tables
since it hidden and managed by Azure for you.

- User defined Routes
You can override the system routes assigned to your subnets by creating a new route table and associating it with
a subnet. A user defined Route can be assigned to multiple subnets, but a Subnet can only have one user defined route table.
If you wanted to have a private subnet (a subnet that cannot reach the internet) you would just create a new route for 0.0.0.0/0 that hops to None. The Next Hop is where to send the route.

The virtual appliance is a VM that runs a network application eg. Firewall. In this hop type you also have to provide the private IP
address to the VM.

### Address Spaces

Azure will reserve 5 of the IP addresses:
* x.x.x.0: Network address
* x.x.x.1: Reserved by Azure for the default gateway
* x.x.x.2, x.x.x.3: Reserved by Azure to map the Azure DNS IPs to the VNet space
* x.x.x.255: Network broadcast

### Subnets

Azure has no concept of private and public subnets and its up to you to configure our subnets to have ensure they do not
reach the internet by ensuring they have no route via the their route table to the internet getway.

You can associate NSG to protect traffic entering and leaving your subnet by applying security rules that can Allow or Deny access
based on IP address, port and protcol.

Azure has a special type of Gateway subnet that is used by Azure VIrtual Network Gateway and that service launches specialized VMs into that subnet.

### Private Links

Azure Private Links allows you to establish secure connections between Azure resources so traffic remains within the Azure Network.
**Private Link Endpoint** is a Network interface that connects you privately and securely to a service powered by Azure Private Link.
Private Endpoint uses a private IP address from your VNet.

### Azure Express Route

Azure ExpressRoutes creates a private connections between Azure Datacenters and infrastructure on your premises or in a colocation environment.

Connectivity can be from an:
* any-to-any (IP VPN)
* point-to-point Ethernet network
* virtual cross connection

ExpressRoute connections don't go over the public internet and as a result can offer: more reliability, faster speeds, consistent latencies, higher security.


### Azure Network Watcher

Azure Network Watcher privides tools to monitor, diagnose, view network metrics, and enable or disable logs for resources in an
Azure virtual network.It is disabled by default.

From Network Watcher you can access:
* IP flow verify checks
* Packet capture
* Troubkeshoot VPNs, NSGs
* NSG flow logs
* Diagnostic logs
* Traffic analytics
* ...

Network watcher can monitor and repair Azure resource you provision eg: VMs, Virtual networks, App gateway, Load balancer.


## Network Security Group (NSG)

Network Security Group filter network traffic to and from Azure resources in a VNet. An NSG is composed of many Security Rules.
Each Security Rules has the following peoperties:
Name - A unique name within the network security groyp
Source or destination - An IP address or CIDR block service Tag or Application Security Group
Port range - specify a single or range of ports. eg. 80 or 10000-10005
Protocol - TCP, UDP, ICMP
Priority - An number between 100 and  4096 with inbound and outbound rules

### Default security rules

Azure sets the following default security rules when you create a NSG:

### Security Rules Logic

Security Rules has a lot of logic to determine how to apply its rules
* You may not create two security rules with the same priority and direction
* You can have 5000 NSG per subscription, 1000 NSG rules per NSG
* Priority:
- Rules are processed in priority order, with lower numbers processed before higher number
* NSG rules are evaluated by priority using the 5-tuple information to allow or deny:
source(1) source port(2) destination(3) destination port(4) protocol(5)


## Azure WAN

It is consolidated networking service that brings many networking security and routing functionalities in a single
operational interface.

### PoPs

A point of presence (PoP) is an entry at the edge of a Network. eg. ISP Datacenter.


